import{_ as q}from"./Brx9_43Z.js";import{d as G,a as p,c8 as H,v as S,c9 as W,N as X,aT as Y,a$ as J,aj as K,al as T,ca as Q,D as Z,a2 as _,bV as ee,o as v,c as f,h as a,j as m,bc as D,$ as V,k as R,a7 as te,f as z,w as N,t as x,a4 as ae,l as L}from"./CMcu4vOi.js";var ne=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],A=e=>{let n=0;for(let r=0;r<e.length;r++){let l=e[r],d=ne.indexOf(l);n=n*83+d}return n},B=e=>{let n=e/255;return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)},E=e=>{let n=Math.max(0,Math.min(1,e));return n<=.0031308?Math.trunc(n*12.92*255+.5):Math.trunc((1.055*Math.pow(n,.4166666666666667)-.055)*255+.5)},oe=e=>e<0?-1:1,I=(e,n)=>oe(e)*Math.pow(Math.abs(e),n),F=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},se=e=>{if(!e||e.length<6)throw new F("The blurhash string must be at least 6 characters");let n=A(e[0]),r=Math.floor(n/9)+1,l=n%9+1;if(e.length!==4+2*l*r)throw new F(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*l*r}`)},ie=e=>{let n=e>>16,r=e>>8&255,l=e&255;return[B(n),B(r),B(l)]},re=(e,n)=>{let r=Math.floor(e/361),l=Math.floor(e/19)%19,d=e%19;return[I((r-9)/9,2)*n,I((l-9)/9,2)*n,I((d-9)/9,2)*n]},le=(e,n,r,l)=>{se(e),l=l|1;let d=A(e[0]),y=Math.floor(d/9)+1,k=d%9+1,j=(A(e[1])+1)/166,c=new Array(k*y);for(let i=0;i<c.length;i++)if(i===0){let h=A(e.substring(2,6));c[i]=ie(h)}else{let h=A(e.substring(4+i*2,6+i*2));c[i]=re(h,j*l)}let b=n*4,g=new Uint8ClampedArray(b*r);for(let i=0;i<r;i++)for(let h=0;h<n;h++){let P=0,s=0,M=0;for(let o=0;o<y;o++)for(let u=0;u<k;u++){let w=Math.cos(Math.PI*h*u/n)*Math.cos(Math.PI*i*o/r),U=c[u+o*k];P+=U[0]*w,s+=U[1]*w,M+=U[2]*w}let C=E(P),$=E(s),t=E(M);g[4*h+0+i*b]=C,g[4*h+1+i*b]=$,g[4*h+2+i*b]=t,g[4*h+3+i*b]=255}return g},ce=le;const he=["gap"],ue=["poster","controls","width","height"],me=["src"],de={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:video-download-line":""},ve=["poster","width","height"],fe=["src"],ge={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:video-download-line":""},pe={key:2,controls:"","h-15":""},be=["src"],we={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:file-download-line":""},ye={hidden:""},Me={p4:"",flex:"","flex-col":"","gap-2":"","max-w-130":""},ke={flex:"","justify-between":""},je={"font-bold":"","text-xl":"","text-secondary":""},Pe={"text-sm":"","btn-outline":"",py0:"",px2:"","text-secondary":"","border-base":""},$e={"whitespace-pre-wrap":""},Ae=G({__name:"StatusAttachment",props:{attachment:{},attachments:{},fullSize:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1}},setup(e){const n=p(()=>e.attachment.previewUrl||e.attachment.url||e.attachment.remoteUrl),r=p(()=>[[e.attachment.url,e.attachment.meta?.original?.width],[e.attachment.remoteUrl,e.attachment.meta?.original?.width],[e.attachment.previewUrl,e.attachment.meta?.small?.width]].filter(([t])=>t).map(([t,o])=>`${t} ${o}w`).join(", ")),l=p(()=>{if(e.attachment.meta?.original?.aspect)return e.attachment.meta.original.aspect;if(e.attachment.meta?.small?.aspect)return e.attachment.meta.small.aspect}),d=p(()=>{if(e.fullSize)return l.value;if(l.value)return H(l.value,.8,6)}),y=p(()=>{const t=e.attachment.meta?.focus?.x||0,o=e.attachment.meta?.focus?.y||0,u=(t/2+.5)*100,w=(o/-2+.5)*100;return`${u}% ${w}%`}),k={video:["mp4","webm","mov","avi","mkv","flv","wmv","mpg","mpeg"],audio:["mp3","wav","ogg","flac","aac","m4a","wma"],image:["jpg","jpeg","png","svg","webp","bmp"],gifv:["gifv","gif"]},j=p(()=>{if(e.attachment.type&&e.attachment.type!=="unknown")return e.attachment.type;for(const[t,o]of Object.entries(k))if(o.some(u=>n.value?.toLowerCase().endsWith(`.${u}`)))return t;return"unknown"}),c=S(),b=W(),g=p(()=>e.attachment.type==="audio"),i=p(()=>e.attachment.type==="video"),h=X("enableAutoplay");Y(c,t=>{const o=c.value?.dataset.ready==="true";if(b.value==="reduce"||!h.value){o&&!c.value?.paused&&c.value?.pause();return}t.forEach(u=>{u.intersectionRatio<=.75?o&&!c.value?.paused&&c.value?.pause():c.value?.play().then(()=>{c.value.dataset.ready="true"}).catch(J)})},{threshold:.75});const P=K(),s=S(e.isPreview||!T(P.value,"enableDataSaving"));function M(){s.value=!0}const C=p(()=>{if(!e.attachment.blurhash)return"";const t=ce(e.attachment.blurhash,32,32);return Q(t,32,32)}),$=S(s.value?e.attachment.previewUrl:C.value);return Z(s,()=>{$.value=s.value?e.attachment.previewUrl:C.value}),(t,o)=>{const u=q,w=_("VDropdown"),U=ee("close-popper");return v(),f("div",{relative:"",ma:"",flex:"",gap:a(g)?"2":""},[a(j)==="video"?(v(),f("button",{key:0,type:"button",relative:"",onClick:o[0]||(o[0]=O=>a(s)?null:M())},[m("video",{ref_key:"video",ref:c,preload:"none",poster:a($),muted:"",loop:"",playsinline:"",controls:a(s),"rounded-lg":"","object-cover":"","fullscreen:object-contain":"",width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,style:D({aspectRatio:a(d),objectPosition:a(y)}),class:V(a(s)?"":"brightness-60 hover:brightness-70 transition-filter")},[m("source",{src:t.attachment.url||t.attachment.previewUrl,type:"video/mp4"},null,8,me)],14,ue),a(s)?R("",!0):(v(),f("span",de))])):a(j)==="gifv"?(v(),f("button",{key:1,type:"button",relative:"",onClick:o[1]||(o[1]=O=>a(s)?null:M())},[m("video",{ref_key:"video",ref:c,preload:"none",poster:a($),muted:"",loop:"",playsinline:"","rounded-lg":"","object-cover":"",width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,style:D({aspectRatio:a(d),objectPosition:a(y)})},[m("source",{src:t.attachment.url||t.attachment.previewUrl,type:"video/mp4"},null,8,fe)],12,ve),a(s)?R("",!0):(v(),f("span",ge))])):a(j)==="audio"?(v(),f("audio",pe,[m("source",{src:t.attachment.url||t.attachment.previewUrl,type:"audio/mp3"},null,8,be)])):(v(),f("button",{key:3,type:"button","focus:outline-none":"","focus:ring":"2 primary inset","rounded-lg":"","h-full":"","w-full":"","aria-label":"Open image preview dialog",relative:"",onClick:o[2]||(o[2]=O=>a(s)?("openMediaPreview"in t?t.openMediaPreview:a(te))(t.attachments?t.attachments:[t.attachment],t.attachments?.indexOf(t.attachment)||0):M())},[z(u,{blurhash:t.attachment.blurhash||"",class:V(["status-attachment-image",a(s)?"":"brightness-60 hover:brightness-70 transition-filter"]),src:a(n),srcset:a(r),width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,alt:t.attachment.description??"Image",style:D({aspectRatio:a(d),objectPosition:a(y)}),"should-load-image":a(s),"rounded-lg":"","h-full":"","w-full":"","object-cover":"",draggable:a(s)},null,8,["blurhash","src","srcset","width","height","alt","style","should-load-image","draggable","class"]),a(s)?R("",!0):(v(),f("span",we))])),t.attachment.description&&!("getPreferences"in t?t.getPreferences:a(T))(a(P),"hideAltIndicatorOnPosts")?(v(),f("div",{key:4,class:V(a(g)?[]:["absolute left-2",a(i)?"top-2":"bottom-2"])},[z(w,{distance:6,placement:"bottom-start"},{popper:N(()=>[m("div",Me,[m("div",ke,[m("h2",je,x(t.$t("status.img_alt.desc")),1),ae((v(),f("button",Pe,[L(x(t.$t("status.img_alt.dismiss")),1)])),[[U]])]),m("p",$e,x(t.attachment.description),1)])]),default:N(()=>[m("button",{"font-bold":"","text-sm":"",class:V(a(g)?"rounded-full h-15 w-15 btn-outline border-base text-secondary hover:bg-active hover:text-active":"rounded-1 bg-black/65 text-white hover:bg-black px1.2 py0.2")},[m("div",ye,x(t.$t("status.img_alt.read",[t.attachment.type])),1),L(" "+x(t.$t("status.img_alt.ALT")),1)],2)]),_:1})],2)):R("",!0)],8,he)}}});export{Ae as _};
