import{a as L,_ as M}from"./BBra7vxC.js";import{d as D,o as n,c as v,f as w,j as o,m as x,k as R,a9 as U,ab as z,ad as T,ae as W,af as j,w as J,$ as G,an as O,v as _,A as P,a as K,cn as $,D as N,x as C,co as Q,cm as X,q as Y,i as Z,cp as ee,b5 as te,b as ne,aS as ae,cq as se,a4 as oe,a5 as ce,h as c,a6 as le,aE as S,aF as B,t as V,J as E,K as ue}from"./CMcu4vOi.js";import{e as re}from"./B5y2QTf5.js";const ie={flex:"","gap-2":"","items-center":""},de={flex:"~ col gap1",shrink:"","h-full":"","overflow-hidden":"","leading-none":""},pe={flex:"~","gap-2":""},ve=D({__name:"SearchAccountInfo",props:{account:{}},setup(g){return(l,e)=>{const f=U,u=z,r=T,i=W,t=j;return n(),v("div",ie,[w(f,{"w-10":"","h-10":"",account:l.account,"shrink-0":""},null,8,["account"]),o("div",de,[o("div",pe,[w(u,{account:l.account,"line-clamp-1":"","ws-pre-wrap":"","break-all":"","text-base":""},null,8,["account"]),l.account.locked?(n(),x(r,{key:0,"text-xs":""})):R("",!0),l.account.bot?(n(),x(i,{key:1,"text-xs":""})):R("",!0)]),w(t,{"text-sm":"",account:l.account,"text-secondary-light":""},null,8,["account"])])])}}}),_e=D({__name:"SearchResult",props:{result:{},active:{type:Boolean}},setup(g){function l(){document.activeElement.blur()}return(e,f)=>{const u=L,r=ve,i=re,t=M;return n(),x(t,{as:"RouterLink","hover:bg-active":"",active:e.active,to:e.result.to,py2:"",block:"",px2:"","aria-selected":e.active,class:G({"bg-active":e.active}),onClick:f[0]||(f[0]=()=>l())},{default:J(()=>[e.result.type==="hashtag"?(n(),x(u,{key:0,hashtag:e.result.data},null,8,["hashtag"])):e.result.type==="account"?(n(),x(r,{key:1,account:e.result.data},null,8,["account"])):e.result.type==="status"?(n(),x(i,{key:2,status:e.result.data,actions:!1,"show-reply-to":!1},null,8,["status"])):R("",!0)]),_:1},8,["active","to","aria-selected","class"])}}}),fe={},he={flex:"","flex-col":"","gap-2":"","px-4":"","py-3":""},me=o("div",{flex:"","gap-4":""},[o("div",null,[o("div",{"w-12":"","h-12":"","rounded-full":"",class:"skeleton-loading-bg"})]),o("div",{flex:"~ col 1 gap-2",pb2:"","min-w-0":""},[o("div",{flex:"",class:"skeleton-loading-bg","h-5":"","w-20":"",rounded:""}),o("div",{flex:"",class:"skeleton-loading-bg","h-4":"","w-full":"",rounded:""})])],-1),ge=[me];function be(g,l){return n(),v("div",he,ge)}const ye=O(fe,[["render",be]]);function xe(g,l={}){const e=_(!1),{client:f}=P(),u=_(!1),r=_([]),i=_([]),t=_([]),h=K(()=>$(g).trim());let b;const y=(a,p=!1)=>{p&&(r.value=[],i.value=[],t.value=[]),r.value=[...r.value,...a.accounts.map(s=>({type:"account",id:s.id,data:s,to:Z(s)}))],i.value=[...i.value,...a.hashtags.map(s=>({type:"hashtag",id:`hashtag-${s.name}`,data:s,to:ee(s.name)}))],t.value=[...t.value,...a.statuses.map(s=>({type:"status",id:s.id,data:s,to:te(s)}))]};N(()=>$(g),()=>{u.value=!!(h.value&&C.value)}),Q(()=>$(g),async()=>{if(!h.value||!C.value)return;u.value=!0,b=f.value.v2.search.list({q:h.value,...$(l),resolve:!!Y.value});const a=await b.next();e.value=!!a.done,a.done||y(a.value,!0),u.value=!1},{debounce:300});const A=async()=>{if(!h.value||!C.value||!b)return;u.value=!0;const a=await b.next();u.value=!1,e.value=!!a.done,a.done||y(a.value)};return{accounts:r,hashtags:i,statuses:t,loading:X(u),next:A}}const ke={"bg-base":"",border:"~ base",h10:"","ps-4":"","pe-1":"","rounded-3":"",flex:"~ row","items-center":"",relative:"","focus-within:box-shadow-outline":""},we=o("div",{"i-ri:search-2-line":"","pointer-events-none":"","text-secondary":"",mt:"1px",class:"rtl-flip"},null,-1),$e=["placeholder"],Se=o("span",{"aria-hidden":"true",class:"i-ri:close-line"},null,-1),Re=[Se],Ae={"left-0":"","top-11":"",absolute:"","w-full":"",z10:"","group-focus-within":"pointer-events-auto visible",invisible:"","pointer-events-none":""},Ie={"w-full":"","bg-base":"",border:"~ base","rounded-3":"","max-h-100":"","overflow-auto":"",py2:""},Ce={key:0,block:"","text-center":"","text-sm":"","text-secondary":""},Be={key:1,block:"","text-center":"","text-sm":"","text-secondary":""},De={key:2},Ne=D({__name:"SearchWidget",setup(g,{expose:l}){const e=_(""),{accounts:f,hashtags:u,loading:r,statuses:i}=xe(e),t=_(0),{t:h}=ne(),b=_(),y=_(),A=ae(),{focused:a}=se(b);l({input:y});const p=K(()=>e.value.length===0?[]:[...u.value.slice(0,3),...f.value,...i.value]);N([p,a],()=>t.value=-1);function s(k){return t.value=(t.value+k%p.value.length+p.value.length)%p.value.length}function q(){const k=t.value;if(e.value.length!==0){if(k===-1){t.value=0;return}document.activeElement.blur(),t.value=-1,A.push(p.value[k].to)}}return(k,d)=>{const F=_e,I=ye;return n(),v("div",{ref_key:"el",ref:b,relative:"",group:""},[o("div",ke,[we,oe(o("input",{ref_key:"input",ref:y,"onUpdate:modelValue":d[0]||(d[0]=m=>le(e)?e.value=m:null),"h-full":"","rounded-3":"","w-full":"","bg-transparent":"",outline:"focus:none","ps-3":"","pe-1":"","ml-1":"",placeholder:c(h)("nav.search"),pb:"1px","placeholder-text-secondary":"",onKeydown:[d[1]||(d[1]=S(B(m=>s(1),["prevent"]),["down"])),d[2]||(d[2]=S(B(m=>s(-1),["prevent"]),["up"])),d[3]||(d[3]=S(B(m=>c(y)?.blur(),["prevent"]),["esc"]))],onKeypress:S(q,["enter"])},null,40,$e),[[ce,c(e)]]),c(e).length?(n(),v("button",{key:0,"btn-action-icon":"","text-secondary":"",onClick:d[4]||(d[4]=m=>{e.value="",c(y)?.focus()})},Re)):R("",!0)]),o("div",Ae,[o("div",Ie,[c(e).trim().length===0?(n(),v("span",Ce,V(c(h)("search.search_desc")),1)):c(r)?(n(),v("div",De,[w(I),w(I),w(I)])):(n(),v(E,{key:1},[c(p).length>0?(n(!0),v(E,{key:0},ue(c(p),(m,H)=>(n(),x(F,{key:m.id,active:c(t)===parseInt(H.toString()),result:m,tabindex:c(a)?0:-1},null,8,["active","result","tabindex"]))),128)):(n(),v("span",Be,V(c(h)("search.search_empty")),1))],64))])])],512)}}});export{Ne as _,ye as a,_e as b,xe as u};
