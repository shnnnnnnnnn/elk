import{d as ie,c7 as ge,a as _e,v as ze,a1 as ve,bv as Le,o as N,c as x,J as Ee,K as Se,j as we,aD as X,h as le,m as Be}from"./CMcu4vOi.js";const ue=typeof window>"u",Ie=!ue&&"loading"in HTMLImageElement.prototype,Ce=!ue&&(!("onscroll"in window)||/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent));function de(e,t=document){return typeof e=="string"?[...t.querySelectorAll(e)]:e instanceof Element?[e]:[...e]}function Ge(e,t){let s,r;return e>=1?(s=t,r=Math.round(t/e)):(s=Math.round(t*e),r=t),{width:s,height:r}}function Pe(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),s=typeof Buffer<"u"?Buffer.from(t,"base64"):Uint8Array.from(atob(t),r=>r.charCodeAt(0));return new Uint8Array(s)}function Ue(e,t){let s;return function(...r){s&&clearTimeout(s),s=setTimeout(()=>{s=void 0,e(...r)},t)}}/**
 * Encodes an RGBA image to a PNG data URI. RGB should not be premultiplied by A.
 *
 * @remarks
 * This is optimized for speed and simplicity and does not optimize for size
 * at all. This doesn't do any compression (all values are stored uncompressed).
 *
 * @see https://github.com/evanw/thumbhash
 * @author Evan Wallace
 * @license MIT
 */function fe(e,t,s){const r=e*4+1,c=6+t*(5+r),o=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,c>>>24,c>>16&255,c>>8&255,c&255,73,68,65,84,120,1],d=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188];let a=1,l=0;for(let i=0,f=0,n=r-1;i<t;i++,n+=r-1)for(o.push(i+1<t?0:1,r&255,r>>8,~r&255,r>>8^255,0),l=(l+a)%65521;f<n;f++){const p=s[f]&255;o.push(p),a=(a+p)%65521,l=(l+a)%65521}o.push(l>>8,l&255,a>>8,a&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[i,f]of[[12,29],[37,41+c]]){let n=-1;for(let p=i;p<f;p++)n^=o[p],n=n>>>4^d[n&15],n=n>>>4^d[n&15];n=~n,o[f++]=n>>>24,o[f++]=n>>16&255,o[f++]=n>>8&255,o[f++]=n&255}return`data:image/png;base64,${typeof Buffer<"u"?Buffer.from(new Uint8Array(o)).toString("base64"):btoa(String.fromCharCode(...o))}`}const re=32,Re="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Ne="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",j=(e,t,s)=>{let r=0;for(;t<s;)r*=83,r+=Ne.indexOf(e[t++]);return r},he=Math.pow,O=Math.PI,Te=O*2,pe=3294.6,ye=269.025,Oe=e=>e>10.31475?he(e/ye+.052132,2.4):e/pe,Q=e=>~~(e>1227e-8?ye*he(e,.416666)-13.025:e*pe+1),T=e=>(e<0?-1:1)*e*e,ce=e=>{for(e+=O/2;e>O;)e-=Te;const t=1.27323954*e-.405284735*T(e);return .225*(T(t)-t)+t};function ke(e){const t=j(e,2,6);return[t>>16,t>>8&255,t&255]}function De(e,t,s,r){const c=j(e,0,1),o=c%9+1,d=~~(c/9)+1,a=o*d;let l=0,h=0,i=0,f=0,n=0,p=0,C=0,z=0,w=0,m=0,v=0,k=0,D=0,L=0;const _=(j(e,1,2)+1)/13446*(r|1),b=new Float64Array(a*3),K=ke(e);for(l=0;l<3;l++)b[l]=Oe(K[l]);for(l=1;l<a;l++)L=j(e,4+l*2,6+l*2),b[l*3]=T(~~(L/(19*19))-9)*_,b[l*3+1]=T(~~(L/19)%19-9)*_,b[l*3+2]=T(L%19-9)*_;const H=t*4,E=new Uint8ClampedArray(H*s);for(f=0;f<s;f++)for(k=O*f/s,i=0;i<t;i++){for(n=0,p=0,C=0,D=O*i/t,h=0;h<d;h++)for(w=ce(k*h),l=0;l<o;l++)z=ce(D*l)*w,m=(l+h*o)*3,n+=b[m]*z,p+=b[m+1]*z,C+=b[m+2]*z;v=4*i+f*H,E[v]=Q(n),E[v+1]=Q(p),E[v+2]=Q(C),E[v+3]=255}return E}function He(e,{ratio:t=1,size:s=re}={}){const{width:r,height:c}=Ge(t,s),o=De(e,r,c);return fe(r,c,o)}function Me(e){let{PI:t,min:s,max:r,cos:c,round:o}=Math,d=e[0]|e[1]<<8|e[2]<<16,a=e[3]|e[4]<<8,l=(d&63)/63,h=(d>>6&63)/31.5-1,i=(d>>12&63)/31.5-1,f=(d>>18&31)/31,n=d>>23,p=(a>>3&63)/63,C=(a>>9&63)/63,z=a>>15,w=r(3,z?n?5:7:a&7),m=r(3,z?a&7:n?5:7),v=n?(e[5]&15)/15:1,k=(e[5]>>4)/15,D=n?6:5,L=0,_=(P,g,U)=>{let B=[];for(let S=0;S<g;S++)for(let I=S?0:1;I*g<P*(g-S);I++)B.push(((e[D+(L>>1)]>>((L++&1)<<2)&15)/7.5-1)*U);return B},b=_(w,m,f),K=_(3,3,p*1.25),H=_(3,3,C*1.25),E=n&&_(5,5,k),M=$e(e),$=o(M>1?32:32*M),q=o(M>1?32/M:32),G=new Uint8Array($*q*4),F=[],W=[];for(let P=0,g=0;P<q;P++)for(let U=0;U<$;U++,g+=4){let B=l,S=h,I=i,se=v;for(let u=0,y=r(w,n?5:3);u<y;u++)F[u]=c(t/$*(U+.5)*u);for(let u=0,y=r(m,n?5:3);u<y;u++)W[u]=c(t/q*(P+.5)*u);for(let u=0,y=0;u<m;u++)for(let A=u?0:1,R=W[u]*2;A*m<w*(m-u);A++,y++)B+=b[y]*F[A]*R;for(let u=0,y=0;u<3;u++)for(let A=u?0:1,R=W[u]*2;A<3-u;A++,y++){let ne=F[A]*R;S+=K[y]*ne,I+=H[y]*ne}if(n)for(let u=0,y=0;u<5;u++)for(let A=u?0:1,R=W[u]*2;A<5-u;A++,y++)se+=E[y]*F[A]*R;let ae=B-2/3*S,oe=(3*B-ae+I)/2,be=oe-I;G[g]=r(0,255*s(1,oe)),G[g+1]=r(0,255*s(1,be)),G[g+2]=r(0,255*s(1,ae)),G[g+3]=r(0,255*s(1,se))}return{w:$,h:q,rgba:G}}function $e(e){let t=e[3],s=e[2]&128,r=e[4]&128,c=r?s?5:7:t&7,o=r?t&7:s?5:7;return c/o}function qe(e){const{w:t,h:s,rgba:r}=Me(Pe(e));return fe(t,s,r)}function Fe(e='img[loading="lazy"]',{hash:t=!0,hashType:s="blurhash",placeholderSize:r=re,updateSizesOnResize:c=!1,onImageLoad:o}={}){const d=new Set;for(const a of de(e)){const l=Z(a,{updateOnResize:c});if(c&&l&&d.add(l),t){const i=te({image:a,hash:typeof t=="string"?t:void 0,hashType:s,size:r});i&&(a.src=i)}if(!a.dataset.src&&!a.dataset.srcset){(typeof __UNLAZY_LOGGING__>"u"||__UNLAZY_LOGGING__)&&console.error("[unlazy] Missing `data-src` or `data-srcset` attribute",a);continue}if(Ce||!Ie){Ae(a),J(a),V(a);continue}if(a.src||(a.src=Re),a.complete&&a.naturalWidth>0){ee(a,o);continue}const h=()=>ee(a,o);a.addEventListener("load",h,{once:!0}),d.add(()=>a.removeEventListener("load",h))}return()=>{for(const a of d)a();d.clear()}}function We(e='img[data-sizes="auto"], source[data-sizes="auto"]'){for(const t of de(e))Z(t)}function ee(e,t){if(e.parentElement?.tagName.toLowerCase()==="picture"){Ae(e),J(e),V(e),t?.(e);return}const r=new Image,{srcset:c,src:o,sizes:d}=e.dataset;if(d==="auto"){const a=me(e);a&&(r.sizes=`${a}px`)}else e.sizes&&(r.sizes=e.sizes);c&&(r.srcset=c),o&&(r.src=o),r.addEventListener("load",()=>{J(e),V(e),t?.(e)},{once:!0})}function te({image:e,hash:t,hashType:s="blurhash",size:r=re,ratio:c}={}){if(!t&&e){const{blurhash:o,thumbhash:d}=e.dataset;t=d||o,s=d?"thumbhash":"blurhash"}if(t)try{if(s==="thumbhash")return qe(t);if(!c&&e){const o=e.width||e.offsetWidth||r,d=e.height||e.offsetHeight||r;c=o/d}return He(t,{ratio:c,size:r})}catch(o){(typeof __UNLAZY_LOGGING__>"u"||__UNLAZY_LOGGING__)&&console.error(`Error generating ${s} placeholder:`,o)}}const Y=new WeakMap;function Z(e,t){if(e.dataset.sizes!=="auto")return;const s=me(e);if(s&&(e.sizes=`${s}px`),e.parentElement?.tagName.toLowerCase()==="picture"&&!t?.skipChildren&&[...e.parentElement.getElementsByTagName("source")].forEach(r=>Z(r,{skipChildren:!0})),t?.updateOnResize){if(!Y.has(e)){const r=Ue(()=>Z(e),500),c=new ResizeObserver(r);Y.set(e,c),c.observe(e)}return()=>{const r=Y.get(e);r&&(r.disconnect(),Y.delete(e))}}}function V(e){e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"))}function J(e){e.dataset.srcset&&(e.srcset=e.dataset.srcset,e.removeAttribute("data-srcset"))}function Ae(e){const t=e.parentElement;t?.tagName.toLowerCase()==="picture"&&([...t.querySelectorAll("source[data-srcset]")].forEach(J),[...t.querySelectorAll("source[data-src]")].forEach(V))}function me(e){return e instanceof HTMLSourceElement?e.parentElement?.getElementsByTagName("img")[0]?.offsetWidth:e.offsetWidth}const xe={key:0},Ye=["type","data-srcset","data-sizes"],je=["src","data-src","data-srcset","data-sizes"],Ze=["src","data-src","data-srcset","data-sizes"],Ve=ie({inheritAttrs:!1,__name:"UnLazyImage",props:{src:{default:void 0},srcSet:{default:void 0},sources:{default:void 0},autoSizes:{type:Boolean,default:!1},blurhash:{default:void 0},thumbhash:{default:void 0},placeholderSrc:{default:void 0},placeholderSize:{default:void 0},placeholderRatio:{default:void 0},lazyLoad:{type:Boolean,default:!0},preload:{type:Boolean,default:!1},ssr:{type:Boolean,default:void 0}},emits:["loaded","error"],setup(e,{emit:t}){const s=e,r=t,c=ge().public.unlazy,o=_e(()=>s.thumbhash||s.blurhash),d=(s.ssr??c.ssr)&&o.value?te({hash:o.value,hashType:s.thumbhash?"thumbhash":"blurhash",size:s.placeholderSize||c.placeholderSize,ratio:s.placeholderRatio}):void 0,a=ze();let l,h;return ve(()=>{if(l?.(),!!a.value){if(o.value&&o.value!==h){const i=te({image:a.value,hash:o.value,hashType:s.thumbhash?"thumbhash":"blurhash",size:s.placeholderSize||c.placeholderSize,ratio:s.placeholderRatio});i&&(a.value.src=i),h=o.value}if(s.preload){s.autoSizes&&We(a.value),ee(a.value);return}s.lazyLoad&&(l=Fe(a.value,{hash:!1,onImageLoad:i=>r("loaded",i)}))}}),Le(()=>{l?.()}),(i,f)=>s.sources?.length?(N(),x("picture",xe,[(N(!0),x(Ee,null,Se(s.sources,(n,p)=>(N(),x("source",{key:p,type:n.type,"data-srcset":n.srcSet,"data-sizes":n.sizes},null,8,Ye))),128)),we("img",X({ref_key:"target",ref:a},i.$attrs,{src:le(d)||i.placeholderSrc,"data-src":i.src,"data-srcset":i.srcSet,"data-sizes":i.autoSizes?"auto":void 0,loading:"lazy",onError:f[0]||(f[0]=n=>r("error",n))}),null,16,je)])):(N(),x("img",X({key:1,ref_key:"target",ref:a},i.$attrs,{src:le(d)||i.placeholderSrc,"data-src":i.src,"data-srcset":i.srcSet,"data-sizes":i.autoSizes?"auto":void 0,loading:"lazy",onError:f[1]||(f[1]=n=>r("error",n))}),null,16,Ze))}}),Ke=ie({inheritAttrs:!1,__name:"CommonBlurhash",props:{blurhash:{default:""},src:{},srcset:{},shouldLoadImage:{type:Boolean,default:!0}},setup(e){return(t,s)=>{const r=Ve;return N(),Be(r,X(t.$attrs,{blurhash:t.blurhash,src:t.src,"src-set":t.srcset,"lazy-load":t.shouldLoadImage,"auto-sizes":""}),null,16,["blurhash","src","src-set","lazy-load"])}}});export{Ke as _};
