import{d as L,a as T,v as M,o,c as f,j as s,$ as V,h as l,m as r,J as C,f as p,t as A,K as H,w as d,i as E,bd as W,ab as x,a9 as O,p as B,n as q,N as J,k as I,b as K,a2 as U,cz as X,aI as Y,s as Q,as as Z,cA as tt,ap as ot,aC as et,aq as nt,aw as it,ax as at}from"./CMcu4vOi.js";import{_ as z}from"./BpHJWG9q.js";import{f as st,g as ct,h as ut,i as rt,e as lt}from"./B5y2QTf5.js";import{_ as pt}from"./DAWFT6Su.js";import{_ as ft}from"./C6zUqCbE.js";import{_ as dt}from"./weTs8tLg.js";import{c as mt,a as _t}from"./Cy5WKwqU.js";import{u as j}from"./DEUvyWAo.js";const gt=["lang"],yt={flex:"","items-center":"","top-0":"","left-2":"","pt-2":"","px-3":""},ht={"me-1":"","ws-nowrap":""},bt={"pb-2":"",ps8:""},vt={key:0},kt={key:1,flex:"~ wrap gap-1.75",p4:""},wt=L({__name:"NotificationGroupedFollow",props:{items:{}},setup(g){const m=T(()=>g.items.items.length),b=M(!1),t=T(()=>m.value>1||m.value===0?void 0:g.items.items[0].status?.language);return(n,_)=>{const k=W,y=x,N=z,R=O,S=B,a=q;return o(),f("article",{flex:"","flex-col":"",relative:"",lang:l(t)??void 0},[s("div",yt,[s("div",{class:V(l(m)>1?"i-ri-group-line":"i-ri-user-3-line"),"me-3":"","color-blue":"","text-xl":"","aria-hidden":"true"},null,2),l(m)>1?(o(),r(k,{key:0,keypath:"notification.followed_you_count",count:l(m)},null,8,["count"])):(o(),f(C,{key:1},[p(y,{account:n.items.items[0]?.account,"text-primary":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),s("span",ht,A(n.$t("notification.followed_you")),1)],64))]),s("div",bt,[l(b)?(o(),f("div",vt,[(o(!0),f(C,null,H(n.items.items,e=>(o(),r(N,{key:e.id,account:e.account,p3:""},null,8,["account"]))),128))])):(o(),f("div",kt,[(o(!0),f(C,null,H(n.items.items,e=>(o(),r(a,{key:e.id,account:e.account},{default:d(()=>[p(S,{to:("getAccountRoute"in n?n.getAccountRoute:l(E))(e.account)},{default:d(()=>[p(R,{account:e.account,"w-12":"","h-12":""},null,8,["account"])]),_:2},1032,["to"])]),_:2},1032,["account"]))),128))]))])],8,gt)}}}),$t={flex:"","flex-col":"",relative:""},At={flex:"","flex-col":"","gap-3":""},Nt={key:0,flex:"~ gap-1"},Rt=s("div",{"i-ri:repeat-fill":"","text-xl":"","me-2":"","color-green":""},null,-1),Ct={ml1:""},St={key:1,flex:"~ gap-1"},It={ms1:""},Et={ps9:"","mt-1":""},Lt=L({__name:"NotificationGroupedLikes",props:{group:{}},setup(g){const m=J("useStarFavoriteIcon"),b=T(()=>g.group.likes.filter(n=>n.reblog)),t=T(()=>g.group.likes.filter(n=>n.favourite&&!n.reblog));return(n,_)=>{const k=O,y=B,N=q,R=st,S=ct,a=ut,e=rt;return o(),f("article",$t,[p(e,{status:n.group.status,pb4:"",pt5:""},{default:d(()=>[s("div",At,[l(b).length?(o(),f("div",Nt,[Rt,(o(!0),f(C,null,H(l(b),(c,v)=>(o(),r(N,{key:v,account:c.account},{default:d(()=>[p(y,{to:("getAccountRoute"in n?n.getAccountRoute:l(E))(c.account)},{default:d(()=>[p(k,{"text-primary":"","font-bold":"",account:c.account,class:"h-1.5em w-1.5em"},null,8,["account"])]),_:2},1032,["to"])]),_:2},1032,["account"]))),128)),s("div",Ct,A(n.$t("notification.reblogged_post")),1)])):I("",!0),l(t).length?(o(),f("div",St,[s("div",{class:V(l(m)?"i-ri:star-line color-yellow":"i-ri:heart-line color-red"),"text-xl":"","me-2":""},null,2),(o(!0),f(C,null,H(l(t),(c,v)=>(o(),r(N,{key:v,account:c.account},{default:d(()=>[p(y,{to:("getAccountRoute"in n?n.getAccountRoute:l(E))(c.account)},{default:d(()=>[p(k,{"text-primary":"","font-bold":"",account:c.account,class:"h-1.5em w-1.5em"},null,8,["account"])]),_:2},1032,["to"])]),_:2},1032,["account"]))),128)),s("div",It,A(n.$t("notification.favourited_post")),1)])):I("",!0)]),s("div",Et,[p(R,{status:n.group.status,"text-secondary":""},null,8,["status"]),n.group.status.content?I("",!0):(o(),f(C,{key:0},[n.group.status.mediaAttachments?.length?(o(),r(S,{key:0,status:n.group.status,"is-preview":!1,"pointer-events-none":""},null,8,["status"])):n.group.status.poll?(o(),r(a,{key:1,status:n.group.status},null,8,["status"])):I("",!0)],64))])]),_:1},8,["status"])])}}}),Ft={flex:"","flex-col":"",relative:""},Gt={flex:"","items-center":"",absolute:"","ps-3":"","pe-4":"","inset-is-0":"","rounded-ie-be-3":"","py-3":"","bg-base":"","top-0":""},Tt=s("div",{"i-ri-user-3-line":"","text-xl":"","me-3":"","color-blue":""},null,-1),Ht={"ws-nowrap":""},Bt={flex:"",p4:"","items-center":"","bg-shaded":""},Pt=s("div",{"i-ri:user-add-line":"","text-xl":"","me-2":"","color-purple":""},null,-1),Dt={flex:"",p4:"","items-center":"","bg-shaded":""},Vt=s("div",{"i-ri:flag-line":"","text-xl":"","me-2":"","color-purple":""},null,-1),xt={flex:"","px-3":"","py-2":""},Ot=s("div",{"i-ri-user-shared-line":"","text-xl":"","me-3":"","color-blue":""},null,-1),qt={"me-1":"","ws-nowrap":""},zt={flex:"~","gap-1":"","items-center":"",mt1:""},jt=s("div",{"i-ri:edit-2-fill":"","text-xl":"","me-1":"","text-secondary":""},null,-1),Mt={"ws-nowrap":""},Wt={key:6,"text-red":"","font-bold":""},Jt=L({__name:"NotificationCard",props:{notification:{}},setup(g){const{t:m}=K(),b=["pleroma:emoji_reaction","reaction"];return b.includes(g.notification.type)&&console.warn(`[DEV] ${m("notification.missing_type")} '${g.notification.type}' (notification.id: ${g.notification.id})`),(t,n)=>{const _=x,k=pt,y=B,N=U("i18n-t"),R=ft,S=z,a=dt,e=lt;return o(),f("article",Ft,[t.notification.type==="follow"?(o(),r(y,{key:0,to:("getAccountRoute"in t?t.getAccountRoute:l(E))(t.notification.account)},{default:d(()=>[s("div",Gt,[Tt,p(_,{account:t.notification.account,"text-primary":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),s("span",Ht,A(t.$t("notification.followed_you")),1)]),p(k,{ms10:"",account:t.notification.account},null,8,["account"])]),_:1},8,["to"])):t.notification.type==="admin.sign_up"?(o(),r(y,{key:1,to:("getAccountRoute"in t?t.getAccountRoute:l(E))(t.notification.account)},{default:d(()=>[s("div",Bt,[Pt,p(_,{account:t.notification.account,"text-purple":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),s("span",null,A(t.$t("notification.signed_up")),1)])]),_:1},8,["to"])):t.notification.type==="admin.report"?(o(),r(y,{key:2,to:("getReportRoute"in t?t.getReportRoute:l(X))(t.notification.report?.id)},{default:d(()=>[s("div",Dt,[Vt,p(N,{keypath:"notification.reported"},{default:d(()=>[p(_,{account:t.notification.account,"text-purple":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),p(_,{account:t.notification.report?.targetAccount,"text-purple":"","ms-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"])]),_:1})])]),_:1},8,["to"])):t.notification.type==="follow_request"?(o(),f(C,{key:3},[s("div",xt,[Ot,p(_,{account:t.notification.account,"text-primary":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),s("span",qt,A(t.$t("notification.request_to_follow")),1)]),p(S,{p:"s-2 e-4 b-2","hover-card":"",account:t.notification.account},{default:d(()=>[p(R,{account:t.notification.account},null,8,["account"])]),_:1},8,["account"])],64)):t.notification.type==="update"?(o(),r(e,{key:4,status:t.notification.status,"in-notification":!0,actions:!1},{meta:d(()=>[s("div",zt,[jt,p(a,{account:t.notification.account,me1:""},null,8,["account"]),s("span",Mt,A(t.$t("notification.update_status")),1)])]),_:1},8,["status"])):t.notification.type==="mention"||t.notification.type==="poll"||t.notification.type==="status"?(o(),r(e,{key:5,status:t.notification.status},null,8,["status"])):b.includes(t.notification.type)?I("",!0):(o(),f("div",Wt," [DEV] "+A(t.$t("notification.missing_type"))+" '"+A(t.notification.type)+"' ",1))])}}}),Kt=["onClick"],D=!1,Ut=L({__name:"NotificationPaginator",props:{paginator:{},stream:{}},setup(g){const m=Number.MAX_VALUE,b=["update","mention","poll","status"];function t({type:a,status:e}){return e||!b.includes(a)}function n(a){const e=a.status?{status:a.status?.id,type:a.type==="reblog"||a.type==="favourite"?"like":a.type}:{type:a.type};return JSON.stringify(e)}function _(a){return!a.header.endsWith("/original/missing.png")}function k(a){const e=[];let c=0,v="",h=[];const F=()=>{if(h.length===0)return;const i=h;if(h=[],i[0].type==="follow"){const u=[...i];u.sort((w,$)=>{const G=_(w.account),P=_($.account);return P&&!G?1:G&&!P?-1:$.account.followersCount-w.account.followersCount}),u.length>0&&_(u[0].account)&&e.push(u.shift()),u.length===1&&_(u[0].account)&&e.push(u.shift()),u.length>0&&e.push({id:`grouped-${c++}`,type:"grouped-follow",items:u});return}else if(i.length&&(i[0].type==="reblog"||i[0].type==="favourite")){if(!i[0].status)return;const u=[];for(const w of i){let $=u.find(G=>G.account.id===w.account.id);$||($={account:w.account},u.push($)),$[w.type==="reblog"?"reblog":"favourite"]=w}u.sort((w,$)=>w.reblog&&(!$.reblog||w.favourite&&!$.favourite)?-1:0),e.push({id:`grouped-${c++}`,type:"grouped-reblogs-and-favourites",status:i[0].status,likes:u});return}e.push(...i)};for(const i of a.filter(t)){const u=n(i);(v!==u||h.length>=m)&&F(),h.push(i),v=u}return F(),e}function y(a){return a.filter(e=>!e.status?.filtered?.find(c=>c.filter.filterAction==="hide"&&c.filter.context.includes("notifications")))}function N(a){const e=[];for(const c of a)if(c.type==="grouped-reblogs-and-favourites"){const v=c;for(const h of v.likes)h.reblog&&e.push(h.reblog),h.favourite&&e.push(h.favourite)}else c.type==="grouped-follow"?e.push(...c.items):e.push(c);return k(y(e))}const{clearNotifications:R}=j(),{formatNumber:S}=Y();return(a,e)=>{const c=wt,v=Lt,h=Jt,F=mt;return o(),r(F,{paginator:a.paginator,preprocess:N,stream:a.stream,eventType:"notification",virtualScroller:D},{updater:d(({number:i,update:u})=>[s("button",{id:"elk_show_new_items","py-4":"",border:"b base",flex:"~ col","p-3":"","w-full":"","text-primary":"","font-bold":"",onClick:()=>{u(),l(R)()}},A(a.$t("timeline.show_new_items",i,{named:{v:l(S)(i)}})),9,Kt)]),default:d(({item:i,active:u})=>[D?(o(),r(l(_t),{key:0,item:i,active:u,tag:"div"},{default:d(()=>[i.type==="grouped-follow"?(o(),r(c,{key:0,items:i,border:"b base"},null,8,["items"])):i.type==="grouped-reblogs-and-favourites"?(o(),r(v,{key:1,group:i,border:"b base"},null,8,["group"])):(o(),r(h,{key:2,notification:i,"hover:bg-active":"",border:"b base"},null,8,["notification"]))]),_:2},1032,["item","active"])):(o(),f(C,{key:1},[i.type==="grouped-follow"?(o(),r(c,{key:0,items:i,border:"b base"},null,8,["items"])):i.type==="grouped-reblogs-and-favourites"?(o(),r(v,{key:1,group:i,border:"b base"},null,8,["group"])):(o(),r(h,{key:2,notification:i,"hover:bg-active":"",border:"b base"},null,8,["notification"]))],64))]),_:1},8,["paginator","stream"])}}}),io=L({__name:"TimelineNotifications",props:{filter:{}},setup(g){const m=Q(),b=Z(tt,""),t={limit:30,types:g.filter?[g.filter]:[]},n=ot().v1.notifications.list(t),_=et(y=>y.user.notification.subscribe());b.value=m.path.replace(/\/notifications\/?/,"");const{clearNotifications:k}=j();return nt(()=>{k(),b.value=m.path.replace(/\/notifications\/?/,"")}),(y,N)=>{const R=Ut;return o(),r(R,it(at({paginator:l(n),stream:l(_)})),null,16)}}});export{io as _};
